<main class="container mx-auto p-4 sm:p-6 lg:p-8 max-w-4xl">
  <header class="text-center mb-8">
    <h1 class="text-4xl font-bold text-slate-800 dark:text-white mb-2">
      AI Pomoćnik za Pakiranje
    </h1>
    <p class="text-lg text-slate-600 dark:text-slate-400">
      Planirajte svoje putovanje bez stresa. Unesite detalje i dopustite AI-u da vam složi savršen popis za pakiranje.
    </p>
  </header>

  <div class="bg-white dark:bg-slate-800 rounded-xl shadow-lg p-6 sm:p-8 mb-8">
    <form (ngSubmit)="generatePackingList()">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        <div>
          <label for="destination" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Destinacija</label>
          <input type="text" id="destination" name="destination" [(ngModel)]="destination" class="w-full bg-slate-50 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" placeholder="Npr. Dubrovnik, Hrvatska">
        </div>
        <div>
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Trajanje putovanja</label>
           <div class="flex items-center space-x-2">
              <input type="date" id="startDate" name="startDate" [(ngModel)]="startDate" class="w-full bg-slate-50 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
              <span class="text-slate-500">-</span>
              <input type="date" id="endDate" name="endDate" [(ngModel)]="endDate" class="w-full bg-slate-50 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
           </div>
        </div>
      </div>
      <div class="mb-6">
        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Planirane aktivnosti</label>
        <div class="space-y-3">
        @for (activity of activities(); track $index) {
            <div class="flex items-center space-x-2 p-1 bg-slate-50 dark:bg-slate-700/50 rounded-lg transition-all">
                <input type="text" [(ngModel)]="activity.description" name="activity-desc-{{$index}}" class="w-full bg-transparent focus:ring-0 border-0 p-2 text-slate-800 dark:text-slate-200 placeholder-slate-400 dark:placeholder-slate-500" placeholder="Npr. Poslovni sastanak">
                <select [(ngModel)]="activity.time" name="activity-time-{{$index}}" class="bg-slate-200 dark:bg-slate-600 border-0 rounded-md p-2 focus:ring-2 focus:ring-blue-500 cursor-pointer">
                    <option value="dan">Dan</option>
                    <option value="noć">Noć</option>
                </select>
                <button type="button" (click)="removeActivity($index)" class="p-2 text-slate-500 hover:text-red-500 dark:hover:text-red-400 rounded-full hover:bg-red-100 dark:hover:bg-slate-600 transition">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd"></path></svg>
                </button>
            </div>
        }
        </div>
        <div class="mt-3">
            <button type="button" (click)="addActivity()" class="w-full flex items-center justify-center text-sm font-medium text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-slate-700 border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg py-2 transition">
              <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd"></path></svg>
              Dodaj aktivnost
            </button>
        </div>
      </div>
      
      <!-- Advanced Options -->
      <div class="mb-6">
        <details class="bg-slate-50 dark:bg-slate-700/50 rounded-lg">
            <summary class="p-4 cursor-pointer font-medium text-slate-700 dark:text-slate-300">Napredne Opcije</summary>
            <div class="p-4 border-t border-slate-200 dark:border-slate-600 grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="formality" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Razina formalnosti</label>
                    <select id="formality" name="formality" [(ngModel)]="formality" class="w-full bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                        <option value="ležerno">Ležerno</option>
                        <option value="poslovno-ležerno">Poslovno Ležerno</option>
                        <option value="formalno">Formalno</option>
                    </select>
                </div>
                <div>
                    <label for="lightLuggage" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Prioritet prtljage</label>
                    <label class="relative inline-flex items-center cursor-pointer">
                      <input type="checkbox" id="lightLuggage" name="lightLuggage" [(ngModel)]="lightLuggage" class="sr-only peer">
                      <div class="w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-slate-600 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-slate-500 peer-checked:bg-blue-600"></div>
                      <span class="ml-3 text-sm font-medium text-slate-700 dark:text-slate-300">Prioritet lagane prtljage</span>
                    </label>
                </div>
            </div>
        </details>
      </div>

      <div class="mt-6 text-center">
        <button type="submit" [disabled]="isLoading()" class="w-full sm:w-auto bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white font-bold py-3 px-8 rounded-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300 dark:focus:ring-blue-800">
          @if (isLoading()) {
            <span class="flex items-center justify-center">
              <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              Generiram...
            </span>
          } @else {
            <span>Generiraj Popis</span>
          }
        </button>
      </div>
    </form>
  </div>
  
  @if (error()) {
    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg relative text-center" role="alert">
      <strong class="font-bold">Greška!</strong>
      <span class="block sm:inline ml-2">{{ error() }}</span>
    </div>
  }

  @if (packingList(); as list) {
    <div class="bg-white dark:bg-slate-800 rounded-xl shadow-lg p-6 sm:p-8 mt-8 animate-fade-in">
      <div class="relative">
        <h2 class="text-3xl font-bold text-slate-800 dark:text-white mb-2 text-center">
          @if(savedTripDetails(); as details) {
            <span>Spremljeni Popis za {{ details.destination }}</span>
          } @else {
            <span>Vaš Personalizirani Popis za Pakiranje</span>
          }
        </h2>
        
        <div class="flex items-center justify-center space-x-2 mb-6">
            <button (click)="saveList()" class="flex items-center text-sm font-medium text-slate-600 dark:text-slate-400 hover:text-blue-600 dark:hover:text-blue-400 transition">
              <svg class="w-4 h-4 mr-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 3.75H6.912a2.25 2.25 0 0 0-2.15 1.588L2.35 13.177a2.25 2.25 0 0 0-.1.661V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18v-4.162c0-.224-.034-.447-.1-.661L19.24 5.338A2.25 2.25 0 0 0 17.088 3.75H15M12 3.75v9" /></svg>
              Spremi
            </button>
            <span class="text-slate-300 dark:text-slate-600">|</span>
            <button (click)="shareList()" class="flex items-center text-sm font-medium text-slate-600 dark:text-slate-400 hover:text-blue-600 dark:hover:text-blue-400 transition">
              <svg class="w-4 h-4 mr-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.186 2.25 2.25 0 0 0-3.933 2.186Z" /></svg>
              Podijeli
            </button>
             @if(savedTripDetails()) {
              <span class="text-slate-300 dark:text-slate-600">|</span>
              <button (click)="clearSavedList()" class="flex items-center text-sm font-medium text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-500 transition">
                <svg class="w-4 h-4 mr-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" /></svg>
                Ukloni
              </button>
            }
        </div>

        @if(actionMessage()) {
          <div class="absolute top-0 right-0 bg-green-100 text-green-800 text-xs font-medium me-2 px-2.5 py-0.5 rounded-full dark:bg-green-900 dark:text-green-300 animate-fade-out">
            {{ actionMessage() }}
          </div>
        }
      
      @if(list.prijedloziKombinacija && list.prijedloziKombinacija.length > 0) {
        <div class="mb-8">
            <h3 class="text-2xl font-semibold text-slate-700 dark:text-slate-300 mb-4 border-b-2 border-slate-200 dark:border-slate-700 pb-2">Prijedlozi Odjevnih Kombinacija</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              @for(suggestion of list.prijedloziKombinacija; track suggestion.aktivnost) {
                <div class="bg-slate-50 dark:bg-slate-700/50 rounded-lg p-5">
                    <h4 class="font-bold text-lg text-blue-600 dark:text-blue-400">{{ suggestion.aktivnost }}</h4>
                    <p class="text-sm text-slate-500 dark:text-slate-400 mb-3">{{ suggestion.opis }}</p>
                    <ul class="space-y-1">
                      @for(item of suggestion.odjevnaKombinacija; track item) {
                        <li class="flex items-center">
                          <svg class="w-4 h-4 text-slate-400 dark:text-slate-500 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg>
                          <span class="text-slate-700 dark:text-slate-300">{{ item }}</span>
                        </li>
                      }
                    </ul>
                </div>
              }
            </div>
        </div>
      }

      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        @for (category of getPackingListKeys(list); track category) {
          @if(category !== 'prijedloziKombinacija' && list[category] && list[category].length > 0) {
            <div class="bg-slate-50 dark:bg-slate-700/50 rounded-lg p-5">
              <h3 class="text-xl font-semibold text-blue-600 dark:text-blue-400 mb-4">{{ formatCategoryTitle(category) }}</h3>
              <ul class="space-y-2">
                @for (item of (list[category] || []); track item) {
                  <li class="flex items-start">
                    <svg class="w-5 h-5 text-green-500 mr-2 mt-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                    <span class="text-slate-700 dark:text-slate-300">{{ item }}</span>
                  </li>
                }
              </ul>
            </div>
          }
        }
      </div>
      </div>
    </div>
  }
</main>
<style>
  .animate-fade-in {
    animation: fadeIn 0.5s ease-in-out;
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .animate-fade-out {
    animation: fadeOut 3s ease-in-out forwards;
  }
  @keyframes fadeOut {
    0% { opacity: 1; transform: translateY(0); }
    80% { opacity: 1; transform: translateY(0); }
    100% { opacity: 0; transform: translateY(-10px); }
  }
</style>